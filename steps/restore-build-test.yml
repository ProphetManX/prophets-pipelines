parameters:
  HasSqlProj: ''

steps:
- ${{ if eq(parameters.HasSqlProj, 'yes')}}:
  - task: NuGetCommand@2
    displayName: 'NuGet restore'
    inputs:
      restoreSolution: '**/*.sqlproj'

  - task: VSBuild@1
    displayName: 'Build Database Projects'
    inputs:
      solution: '**/*.sqlproj'

# dotnet core inherintly restores when a build is run
- task: DotNetCoreCLI@2
  displayName: 'Build Solution'
  inputs:
    command: 'build'
    projects: '**/*.csproj'

- task: VSTest@2
  displayName: 'Run Unit Tests'
  inputs:
    testSelector: 'testAssemblies'
    testAssemblyVer2: |
        **\*test*.dll
        !**\*TestAdapter.dll
        !**\obj\**
    searchFolder: '$(System.DefaultWorkingDirectory)'
    diagnosticsEnabled: true